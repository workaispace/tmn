<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Excel-style Calculator</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f0f2f5; padding: 40px 20px; color: #333; }
        .container { max-width: 450px; margin: 0 auto; background: white; padding: 30px; border-radius: 15px; box-shadow: 0 10px 25px rgba(0,0,0,0.05); }
        h2 { text-align: center; margin-bottom: 25px; color: #1a73e8; }
        .group { margin-bottom: 20px; border-bottom: 1px solid #eee; padding-bottom: 15px; }
        .row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        label { font-size: 14px; font-weight: 600; color: #5f6368; }
        input { width: 140px; padding: 8px 12px; border: 2px solid #dfe1e5; border-radius: 8px; text-align: right; transition: all 0.3s; font-size: 15px; }
        input:focus { border-color: #1a73e8; outline: none; background: #f8fbff; }
        input.readonly { background-color: #f1f3f4; border-color: #f1f3f4; color: #202124; font-weight: bold; cursor: default; }
        .section-label { font-size: 12px; text-transform: uppercase; color: #9aa0a6; margin-bottom: 15px; display: block; letter-spacing: 1px; }
        .positive { color: #1e8e3e; }
        .negative { color: #d93025; }
    </style>
</head>
<body>

<div class="container">
    <h2>Калькулятор опциона ОФЗ</h2>

    <div class="group">
        <span class="section-label">Цена</span>
        <div class="row">
            <label>Текущая цена:</label>
            <input type="number" id="c7" value="58" oninput="runCalc()">
        </div>
        <div class="row">
            <label>Ожидаемая цена:</label>
            <input type="number" id="c8" value="60" oninput="runCalc()">
        </div>
        <div class="row">
            <label>Фин рез цены:</label>
            <input type="text" id="c9" class="readonly" readonly>
        </div>
    </div>

    <div class="group">
        <span class="section-label">Параметры</span>
        <div class="row">
            <label>Цена размещения %:</label>
            <input type="number" id="c12" value="20" oninput="runCalc()">
        </div>
        <div class="row">
            <label>Сумма инвестирования:</label>
            <input type="number" id="c13" value="5000000" oninput="runCalc()">
        </div>
        <div class="row">
            <label>Размер позиции:</label>
            <input type="text" id="c14" class="readonly" readonly>
        </div>
    </div>

    <div class="group" style="border-bottom: none;">
        <span class="section-label">Итоговые расчеты</span>
        <div class="row">
            <label>Уплачено:</label>
            <input type="text" id="c17" class="readonly" readonly>
        </div>
        <div class="row">
            <label>Возвращено:</label>
            <input type="text" id="c18" class="readonly" readonly title="Если C14*C9 < 0, то 0">
        </div>
        <div class="row">
            <label>Прибыль:</label>
            <input type="text" id="c19" class="readonly" readonly>
        </div>
        <div class="row">
            <label>Финансовый результат:</label>
            <input type="text" id="c20" class="readonly" readonly>
        </div>
    </div>
</div>

<script>
    function runCalc() {
        // Получаем значения
        const c7 = parseFloat(document.getElementById('c7').value) || 0;
        const c8 = parseFloat(document.getElementById('c8').value) || 0;
        const c12 = parseFloat(document.getElementById('c12').value) || 0;
        const c13 = parseFloat(document.getElementById('c13').value) || 0;

        // Расчет C9 = C8/C7 - 1
        let valC9 = (c7 !== 0) ? (c8 / c7 - 1) : 0;
        document.getElementById('c9').value = (valC9 * 100).toFixed(2) + ' %';

        // Расчет C14 = C13 / (C12/100) 
        // Примечание: предполагаем, что C12 вводится как целое число процентов
        let valC14 = (c12 !== 0) ? (c13 / (c12 / 100)) : 0;
        document.getElementById('c14').value = valC14.toLocaleString(undefined, {maximumFractionDigits: 2});

        // C17 = C13
        let valC17 = c13;
        document.getElementById('c17').value = valC17.toLocaleString();

        // C18 = ЕСЛИ((C14*C9)<0; 0; C14*C9)
        let rawC18 = valC14 * valC9;
        let valC18 = (rawC18 < 0) ? 0 : rawC18;
        document.getElementById('c18').value = valC18.toLocaleString(undefined, {maximumFractionDigits: 2});

        // C19 = C18 - C17
        let valC19 = valC18 - valC17;
        document.getElementById('c19').value = valC19.toLocaleString(undefined, {maximumFractionDigits: 2});

        // C20 = C19 / C17
        let c20Field = document.getElementById('c20');
        if (valC17 !== 0) {
            let valC20 = valC19 / valC17;
            c20Field.value = (valC20 * 100).toFixed(2) + ' %';
            
            // Динамический цвет
            c20Field.className = 'readonly ' + (valC20 >= 0 ? 'positive' : 'negative');
        } else {
            c20Field.value = "0.00 %";
        }
    }

    // Инициализация при старте
    runCalc();
</script>

</body>
</html>